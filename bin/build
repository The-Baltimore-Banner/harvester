#!/bin/bash

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
DOCKERFILE="${DIR}/../Dockerfile"
TAG="docker.artifactory.ap.org/interact/harvester"

VERSION="$1"
if [[ -z $VERSION ]]; then
  echo "No version specified -- using package.json version"
  VERSION="v$( cat "$DIR/../package.json" | jq '.version' | sed 's/"//g' )"
  echo "Found version $VERSION"
fi

NAME="${TAG}:${VERSION}"
echo "Building version ${NAME}"

docker build -t "${NAME}" -f "${DOCKERFILE}" "${DIR}/.."
